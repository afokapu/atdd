Metadata-Version: 2.4
Name: atdd
Version: 0.1.0
Summary: ATDD Platform - Acceptance Test Driven Development toolkit
License: MIT
Requires-Python: >=3.10
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: pyyaml
Provides-Extra: dev
Requires-Dist: pytest; extra == "dev"
Requires-Dist: pytest-xdist; extra == "dev"
Dynamic: license-file

# ATDD Platform - Unified Command Interface

**The Coach orchestrates all ATDD lifecycle operations through a single entry point.**

## Quick Start

All ATDD operations through one command:

```bash
# Show all available commands
./atdd/atdd.py --help

# Quick status check
./atdd/atdd.py --status

# Generate inventory
./atdd/atdd.py --inventory

# Run all validators
./atdd/atdd.py --test all
```

---

## Commands Reference

### ðŸ“Š Inventory

Generate comprehensive repository inventory cataloging all artifacts:

```bash
# Generate inventory (YAML format)
./atdd/atdd.py --inventory

# Generate inventory (JSON format)
./atdd/atdd.py --inventory --format json
```

**Catalogs:**
- ATDD infrastructure (`atdd/` - conventions, schemas, validators)
- Planning artifacts (`plan/` - trains, wagons, features, WMBT)
- Testing artifacts (`contracts/`, `telemetry/`)
- Implementation files (`python/`, `supabase/`, `web/`)
- Test files (meta-validators + feature tests)
- Documentation and facts/logs

---

### ðŸ—‚ï¸ Registry Updates

Refresh registries derived from source artifacts:

```bash
# Update all registries
./atdd/atdd.py --update-registry all

# Update specific registries
./atdd/atdd.py --update-registry wagons
./atdd/atdd.py --update-registry contracts
./atdd/atdd.py --update-registry telemetry
```

---

### ðŸ§ª Validation

Run ATDD meta-validators to validate platform quality:

```bash
# Run all meta-validators (planner + tester + coder)
./atdd/atdd.py --test all

# Run specific phase validators
./atdd/atdd.py --test planner    # Planning phase validation
./atdd/atdd.py --test tester     # Testing phase validation
./atdd/atdd.py --test coder      # Implementation phase validation
./atdd/atdd.py --test coach      # Coach utilities validation

# With options
./atdd/atdd.py --test all --verbose     # Verbose output
./atdd/atdd.py --test all --coverage    # With coverage report
./atdd/atdd.py --test all --html        # Generate HTML report
./atdd/atdd.py --test all --coverage --html  # Both!

# Quick smoke test (fast, no reports)
./atdd/atdd.py --quick
```

---

### ðŸ“ˆ Status

Quick platform status summary:

```bash
./atdd/atdd.py --status
```

Shows:
- Directory structure
- Validator file counts
- Phase breakdown

---

## Validator Organization

### ATDD Lifecycle Meta-Validators (`atdd/`)

Validators that validate the ATDD platform itself. **Auto-discovered** by pytest - just add `test_*.py` files!

#### ðŸ“‹ Planner (`atdd/planner/`)

Validates planning artifacts in `plan/`:

- âœ… Wagon manifest schema validation
- âœ… Train structure and URN validation
- âœ… Cross-reference coherence
- âœ… URN â†’ filesystem resolution
- âœ… Uniqueness constraints
- âœ… Traceability chain validation
- âœ… WMBT consistency and vocabulary

**Count:** 9 validator files

**Run:**
```bash
./atdd/atdd.py --test planner
```

#### ðŸ§ª Tester (`atdd/tester/`)

Validates testing artifacts and conventions:

- âœ… Contract schema compliance (`contracts/`)
- âœ… Telemetry structure (`telemetry/`)
- âœ… Test naming conventions (Python, TypeScript)
- âœ… Preact/TypeScript web test structure (`web/tests/`)
- âœ… Acceptance criteria mapping
- âœ… Coverage adequacy
- âœ… Fixture validity
- âœ… Test isolation (no sys.path manipulation, no global state)
- âœ… Dual AC reference enforcement

**Count:** 21 validator files

**Run:**
```bash
./atdd/atdd.py --test tester
```

#### âš™ï¸ Coder (`atdd/coder/`)

Validates implementation quality across languages:

- âœ… Architecture compliance (`python/`, `supabase/`, `web/`)
- âœ… Preact 4-layer boundary enforcement (`web/src/`)
- âœ… Commons structure (Python & TypeScript)
- âœ… Import boundary enforcement
- âœ… DTO testing patterns
- âœ… Train infrastructure compliance
- âœ… Complexity thresholds
- âœ… Quality metrics
- âœ… Cross-language consistency

**Count:** 22 validator files

**Run:**
```bash
./atdd/atdd.py --test coder
```

#### ðŸŽ¯ Coach (`atdd/coach/`)

Validates cross-phase coordination:

- âœ… Registry integrity (wagons, contracts, telemetry)
- âœ… Contract consumer validation
- âœ… Traceability enforcement
- âœ… Feature path updates

**Count:** 5 validator files

**Run:**
```bash
./atdd/atdd.py --test coach
```

---

## Architecture

```
atdd/
â”œâ”€â”€ atdd.py                      # Main CLI entry point (THE COACH)
â”œâ”€â”€ coach/                       # Cross-phase coordination
â”‚   â”œâ”€â”€ commands/                # Command implementations
â”‚   â”‚   â”œâ”€â”€ inventory.py         # Repository inventory generator
â”‚   â”‚   â”œâ”€â”€ test_runner.py       # Test execution engine
â”‚   â”‚   â””â”€â”€ registry.py          # Registry update commands
â”‚   â”œâ”€â”€ utils/                   # Coach utilities
â”‚   â”‚   â””â”€â”€ graph/               # URN graph utilities
â”‚   â””â”€â”€ validators/              # Coach meta-validators
â”‚       â”œâ”€â”€ shared_fixtures.py   # Shared pytest fixtures
â”‚       â”œâ”€â”€ test_registry.py
â”‚       â”œâ”€â”€ test_traceability.py
â”‚       â””â”€â”€ test_validate_contract_consumers.py
â”‚
â”œâ”€â”€ planner/                     # Phase 1: Planning validation
â”‚   â”œâ”€â”€ conventions/             # Planning conventions (YAML)
â”‚   â”‚   â”œâ”€â”€ wagon.convention.yaml
â”‚   â”‚   â”œâ”€â”€ train.convention.yaml
â”‚   â”‚   â”œâ”€â”€ wmbt.convention.yaml
â”‚   â”‚   â””â”€â”€ feature.convention.yaml
â”‚   â”œâ”€â”€ schemas/                 # Planning schemas (JSON Schema)
â”‚   â”‚   â”œâ”€â”€ wagon.schema.json
â”‚   â”‚   â”œâ”€â”€ train.schema.json
â”‚   â”‚   â”œâ”€â”€ wmbt.schema.json
â”‚   â”‚   â””â”€â”€ feature.schema.json
â”‚   â”œâ”€â”€ validators/              # Planning validators (auto-discovered)
â”‚   â”‚   â”œâ”€â”€ conftest.py          # Imports coach.validators.shared_fixtures
â”‚   â”‚   â”œâ”€â”€ test_plan_wagons.py
â”‚   â”‚   â”œâ”€â”€ test_plan_cross_refs.py
â”‚   â”‚   â”œâ”€â”€ test_plan_urn_resolution.py
â”‚   â”‚   â”œâ”€â”€ test_plan_uniqueness.py
â”‚   â”‚   â”œâ”€â”€ test_wagon_urn_chain.py
â”‚   â”‚   â”œâ”€â”€ test_train_validation.py
â”‚   â”‚   â””â”€â”€ test_wmbt_*.py
â”‚   â””â”€â”€ conftest.py              # Root planner configuration
â”‚
â”œâ”€â”€ tester/                      # Phase 2: Testing validation
â”‚   â”œâ”€â”€ conventions/             # Testing conventions (YAML)
â”‚   â”‚   â”œâ”€â”€ red.convention.yaml
â”‚   â”‚   â”œâ”€â”€ contract.convention.yaml
â”‚   â”‚   â”œâ”€â”€ telemetry.convention.yaml
â”‚   â”‚   â”œâ”€â”€ filename.convention.yaml
â”‚   â”‚   â””â”€â”€ artifact.convention.yaml
â”‚   â”œâ”€â”€ schemas/                 # Testing schemas (JSON Schema)
â”‚   â”‚   â”œâ”€â”€ contract.schema.json
â”‚   â”‚   â”œâ”€â”€ telemetry_signal.schema.json
â”‚   â”‚   â””â”€â”€ artifact.schema.json
â”‚   â”œâ”€â”€ utils/                   # Tester utilities
â”‚   â”‚   â””â”€â”€ filename.py          # URN-based filename utilities
â”‚   â”œâ”€â”€ validators/              # Testing validators (auto-discovered)
â”‚   â”‚   â”œâ”€â”€ conftest.py          # Imports coach.validators.shared_fixtures
â”‚   â”‚   â”œâ”€â”€ test_contract_*.py
â”‚   â”‚   â”œâ”€â”€ test_telemetry_*.py
â”‚   â”‚   â”œâ”€â”€ test_*_test_naming.py
â”‚   â”‚   â”œâ”€â”€ test_red_*.py
â”‚   â”‚   â”œâ”€â”€ test_acceptance_*.py
â”‚   â”‚   â”œâ”€â”€ test_coverage_*.py
â”‚   â”‚   â”œâ”€â”€ test_fixture_*.py
â”‚   â”‚   â””â”€â”€ test_isolation.py
â”‚   â””â”€â”€ conftest.py              # Root tester configuration
â”‚
â”œâ”€â”€ coder/                       # Phase 3: Implementation validation
â”‚   â”œâ”€â”€ conventions/             # Coding conventions (YAML)
â”‚   â”‚   â”œâ”€â”€ backend.convention.yaml
â”‚   â”‚   â”œâ”€â”€ frontend.convention.yaml
â”‚   â”‚   â”œâ”€â”€ boundaries.convention.yaml
â”‚   â”‚   â”œâ”€â”€ commons.convention.yaml
â”‚   â”‚   â”œâ”€â”€ green.convention.yaml
â”‚   â”‚   â”œâ”€â”€ refactor.convention.yaml
â”‚   â”‚   â”œâ”€â”€ train.convention.yaml
â”‚   â”‚   â””â”€â”€ dto.convention.yaml
â”‚   â”œâ”€â”€ schemas/                 # Coder schemas (JSON Schema)
â”‚   â”‚   â””â”€â”€ (future schemas)
â”‚   â””â”€â”€ validators/              # Implementation validators (auto-discovered)
â”‚       â”œâ”€â”€ test_python_architecture.py
â”‚       â”œâ”€â”€ test_typescript_architecture.py
â”‚       â”œâ”€â”€ test_preact_layer_boundaries.py
â”‚       â”œâ”€â”€ test_commons_structure.py
â”‚       â”œâ”€â”€ test_import_boundaries.py
â”‚       â”œâ”€â”€ test_wagon_boundaries.py
â”‚       â”œâ”€â”€ test_dto_testing_patterns.py
â”‚       â”œâ”€â”€ test_train_*.py
â”‚       â”œâ”€â”€ test_complexity.py
â”‚       â”œâ”€â”€ test_quality_metrics.py
â”‚       â””â”€â”€ test_cross_language_consistency.py
â”‚
â”œâ”€â”€ conftest.py                  # Root pytest configuration
â””â”€â”€ README.md                    # This file
```

---

## Coach Role

The **coach** orchestrates all ATDD operations:

- **Coordinates** across the three phases (planner â†’ tester â†’ coder)
- **Provides** shared fixtures for cross-phase data
- **Executes** commands (inventory, test, report, validate)
- **Enforces** platform conventions and boundaries
- **Centralizes** conventions and schemas in `atdd/*/conventions/` and `atdd/*/schemas/`

### Conventions & Schemas

Each phase has its own conventions (YAML) and schemas (JSON Schema):

```yaml
atdd/
â”œâ”€â”€ planner/conventions/    # Planning rules
â”œâ”€â”€ planner/schemas/        # Planning data structures
â”œâ”€â”€ tester/conventions/     # Testing rules
â”œâ”€â”€ tester/schemas/         # Testing data structures
â”œâ”€â”€ coder/conventions/      # Coding rules
â””â”€â”€ coder/schemas/          # Coding data structures
```

Validators reference these via:
```python
CONVENTION = REPO_ROOT / "atdd" / "coder" / "conventions" / "backend.convention.yaml"
SCHEMA = REPO_ROOT / "atdd" / "planner" / "schemas" / "wagon.schema.json"
```

---

## Auto-Discovery

**Validators are auto-discovered by pytest!** Just follow the pattern:

1. Create a file: `atdd/{phase}/validators/test_{feature}.py`
2. Write tests with `def test_*()` or `class Test*`
3. Run: `./atdd/atdd.py --test {phase}`

**No registration needed!** Pytest finds all `test_*.py` files automatically.

```bash
# Example: Add new validator
touch atdd/coder/validators/test_my_new_check.py

# It's automatically discovered and run
./atdd/atdd.py --test coder
```

---

## Philosophy

All validators follow the **Independence Principle**:

- âœ… **Self-contained** - No external utility dependencies
- âœ… **Well-documented** - Clear rules in docstrings
- âœ… **Convention-driven** - Reference YAML conventions
- âœ… **Executable specifications** - Validators ARE the contracts

Validators may be **inspired by** utilities but are **not coupled to** them.

---

## Examples

### Generate Inventory + Run Validators

```bash
# Get full repository snapshot
./atdd/atdd.py --inventory > inventory.yaml

# Validate everything
./atdd/atdd.py --test all --html --coverage

# View results
open atdd/test_report.html
open atdd/htmlcov/index.html
```

### Validate Specific Phase

```bash
# Just validate planning artifacts
./atdd/atdd.py --test planner --verbose

# Just validate contracts and test naming
./atdd/atdd.py --test tester --html

# Just validate implementation architecture
./atdd/atdd.py --test coder --coverage
```

### CI/CD Integration

```bash
# In CI pipeline
./atdd/atdd.py --test all --coverage --html || exit 1

# Quick pre-commit check
./atdd/atdd.py --quick

# Parallel execution (default)
./atdd/atdd.py --test all  # Uses pytest-xdist -n auto
```

---

## Development

### Adding New Validators

1. **Choose the right phase:**
   - **planner/validators/** - Validating planning artifacts (wagons, trains, URNs, WMBT)
   - **tester/validators/** - Validating testing artifacts (contracts, test naming, coverage)
   - **coder/validators/** - Validating implementation (architecture, quality, boundaries)
   - **coach/validators/** - Validating cross-phase concerns (registries, traceability)

2. **Create the validator file:**
   ```bash
   touch atdd/{phase}/validators/test_my_feature.py
   ```

3. **Write the validator:**
   ```python
   """
   Test my feature follows convention.

   Convention: atdd/{phase}/conventions/my.convention.yaml
   """
   import pytest
   from pathlib import Path

   REPO_ROOT = Path(__file__).resolve().parents[3]

   def test_my_validation():
       """SPEC-{PHASE}-{ID}: Description"""
       # Your validation logic
       assert condition, "Error message"
   ```

4. **Run validators:**
   ```bash
   ./atdd/atdd.py --test <phase> --verbose
   ```

5. **It's automatically discovered!** No registration needed.

### Adding New Conventions

1. **Create convention file:**
   ```bash
   touch atdd/{phase}/conventions/my_feature.convention.yaml
   ```

2. **Define the convention:**
   ```yaml
   version: "1.0"
   name: "My Feature Convention"
   description: "Rules for my feature"

   rules:
     rule_1:
       description: "First rule"
       example: "Example pattern"

   enforcement:
     validators:
       location: "atdd/{phase}/validators/test_my_feature.py"
       specs:
         - id: "SPEC-{PHASE}-{ID}"
           description: "What this validates"
   ```

3. **Reference in validator:**
   ```python
   MY_CONVENTION = REPO_ROOT / "atdd" / "{phase}" / "conventions" / "my_feature.convention.yaml"
   ```

### Extending the CLI

Add new commands in `atdd/coach/commands/`:

```python
# coach/commands/my_command.py
class MyCommand:
    def __init__(self, repo_root):
        self.repo_root = repo_root

    def run(self):
        # Implementation
        return 0

# Register in atdd/atdd.py
from coach.commands.my_command import MyCommand

# Add argument in main()
parser.add_argument("--my-command", ...)

# Handle in main()
if args.my_command:
    cmd = MyCommand(repo_root)
    return cmd.run()
```

---

## Test Results

Current status (as of latest run):

```bash
$ ./atdd/atdd.py --test all
========== 30 failed, 445 passed, 411 skipped ==========

Pass rate: 93.7%
Total validators: 57 files
  - Planner: 9 validators
  - Tester: 21 validators
  - Coder: 22 validators
  - Coach: 5 validators
```

---

## Related Documentation

- `CLAUDE.md` - Project-level ATDD workflow and missions
- `sessions/SESSION-00-atdd-platform-migration.md` - Migration progress tracking
- Individual convention files in `atdd/*/conventions/`
- Individual schema files in `atdd/*/schemas/`

---

## Support

For questions or issues:
- Review conventions in `atdd/*/conventions/*.yaml`
- Review schemas in `atdd/*/schemas/*.json`
- Run `./atdd/atdd.py --help`
- Check validator output for specific validation failures
- See `sessions/SESSION-00-atdd-platform-migration.md` for recent changes
