{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://atdd.dev/schemas/config.schema.json",
  "title": "ATDD Config",
  "description": "Schema for .atdd/config.yaml configuration file",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "description": "Configuration schema version",
      "pattern": "^[0-9]+\\.[0-9]+$",
      "examples": ["1.0"]
    },
    "release": {
      "type": "object",
      "description": "Release/versioning settings",
      "properties": {
        "version_file": {
          "type": "string",
          "description": "Path to version file (relative to repo root)",
          "examples": ["pyproject.toml", "package.json", "VERSION"]
        },
        "tag_prefix": {
          "type": "string",
          "description": "Prefix for git tags",
          "default": "v",
          "examples": ["v", ""]
        }
      },
      "required": ["version_file"],
      "additionalProperties": false
    },
    "sync": {
      "type": "object",
      "description": "Agent config file sync settings",
      "properties": {
        "agents": {
          "type": "array",
          "description": "List of agents to sync ATDD rules to",
          "items": {
            "type": "string",
            "enum": ["claude", "codex", "gemini", "qwen"]
          },
          "uniqueItems": true,
          "default": ["claude"]
        }
      },
      "additionalProperties": false
    },
    "toolkit": {
      "type": "object",
      "description": "ATDD toolkit metadata",
      "properties": {
        "last_version": {
          "type": "string",
          "description": "Last installed ATDD toolkit version"
        }
      },
      "required": ["last_version"],
      "additionalProperties": false
    },
    "coverage": {
      "type": "object",
      "description": "Hierarchy coverage validation settings (ATDD Hierarchy Coverage Spec v0.1)",
      "properties": {
        "exceptions": {
          "type": "object",
          "description": "Allow-lists for coverage exceptions",
          "properties": {
            "wagons_not_in_train": {
              "type": "array",
              "items": {"type": "string"},
              "description": "Wagon slugs allowed without train coverage"
            },
            "features_orphaned": {
              "type": "array",
              "items": {"type": "string"},
              "description": "Feature URNs allowed without wagon manifest reference"
            },
            "wmbts_without_acceptance": {
              "type": "array",
              "items": {"type": "string"},
              "description": "WMBT URNs allowed without acceptance criteria"
            },
            "acceptance_without_tests": {
              "type": "array",
              "items": {"type": "string"},
              "description": "Acceptance URNs allowed without test coverage"
            },
            "contracts_unreferenced": {
              "type": "array",
              "items": {"type": "string"},
              "description": "Contract URNs allowed without produce/consume"
            },
            "telemetry_unreferenced": {
              "type": "array",
              "items": {"type": "string"},
              "description": "Telemetry URNs allowed without references"
            },
            "features_without_implementation": {
              "type": "array",
              "items": {"type": "string"},
              "description": "Feature URNs allowed without code implementation"
            }
          },
          "additionalProperties": false
        },
        "thresholds": {
          "type": "object",
          "description": "Coverage threshold settings",
          "properties": {
            "min_acceptance_coverage": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "default": 80,
              "description": "Minimum percentage of acceptances that must have tests"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "localization": {
      "type": "object",
      "description": "Localization validation settings (Localization Manifest Spec v1)",
      "properties": {
        "manifest": {
          "type": "string",
          "description": "Path to localization manifest.json relative to repo root (e.g., web/locales/manifest.json)"
        }
      },
      "additionalProperties": false
    },
    "github": {
      "type": "object",
      "description": "GitHub integration settings for issue-based session tracking",
      "properties": {
        "repo": {
          "type": "string",
          "description": "GitHub repository in owner/name format",
          "pattern": "^[a-zA-Z0-9._-]+/[a-zA-Z0-9._-]+$",
          "examples": ["janetbusiness/jel-app", "afokapu/atdd"]
        },
        "project_number": {
          "type": "integer",
          "description": "GitHub Projects v2 number (visible in URL)",
          "minimum": 1,
          "examples": [1]
        },
        "project_id": {
          "type": "string",
          "description": "GitHub Projects v2 node ID (GraphQL identifier)",
          "pattern": "^PVT_",
          "examples": ["PVT_kwHOAIbyOM4BPpKf"]
        },
        "field_schema": {
          "const": "atdd/coach/schemas/project_fields.schema.json",
          "description": "Reference to the custom field schema definition"
        }
      },
      "required": ["repo", "project_number", "project_id"],
      "additionalProperties": false
    },
    "coach": {
      "type": "object",
      "description": "Coach agent validation settings",
      "properties": {
        "session_gate_command_prefixes": {
          "type": "array",
          "description": "Allowed prefixes for gate commands in session files",
          "items": {"type": "string"},
          "default": ["atdd", "pytest", "python", "npm", "supabase"],
          "examples": [["atdd", "pytest", "npm run test"]]
        },
        "session_gate_command_exceptions": {
          "type": "array",
          "description": "Session files exempt from gate command prefix validation (by filename pattern)",
          "items": {"type": "string"},
          "default": [],
          "examples": [["SESSION-00-*.md", "SESSION-01-legacy.md"]]
        },
        "archive_status_warnings": {
          "type": "boolean",
          "description": "Warn when COMPLETE sessions not in archive or archived sessions not COMPLETE",
          "default": true
        }
      },
      "additionalProperties": false
    }
  },
  "required": ["version", "release"],
  "additionalProperties": false
}
